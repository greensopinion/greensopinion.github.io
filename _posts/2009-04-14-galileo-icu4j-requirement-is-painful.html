---
layout: imported-post
title: Galileo ICU4J Requirement Is Painful
date: '2009-04-14T08:33:00.000-07:00'
author: David Green
tags:
- Java
- Mylyn
- WikiText
- Eclipse
modified_time: '2009-04-14T08:40:06.205-07:00'
blogger_id: tag:blogger.com,1999:blog-1482979278030787271.post-5052361975001061519
blogger_orig_url: http://greensopinion.blogspot.com/2009/04/galileo-icu4j-requirement-is-painful.html
---

<p>Projects <a href="http://wiki.eclipse.org/Galileo_Simultaneous_Release#Requirements_For_Participation">must use ICU4J</a> if they wish to participate in the <a href="http://wiki.eclipse.org/Galileo">Galileo</a> release of Eclipse, due this summer.  Though such a requirement may make good sense in theory, in practice adopting <a href="http://wiki.eclipse.org/ICU4J">ICU4J</a> is painful.  Not only does this policy stifle innovation for questionable gain, such a burden makes participating in the Eclipse ecosystem less attractive.   </p><p>ICU4J is designed to be a drop-in replacement for Java classes that perform poorly or behave incorrectly.  The idea is that you change your import statements, recompile and everything works.  In applying this technique to Mylyn WikiText, I’ve discovered that it’s not that easy.</p><p>Mylyn WikiText makes use of two classes that are to be replaced by ICU4J equivalents: MessageFormat and ResourceBundle.</p><h4 id="ResourceBundle">ResourceBundle</h4><p>ResourceBundle conversion should be easy, right? ICU4J provides UResourceBundle, which extends ResourceBundle.... wow, that’s great.  All I should have to do is replace <code>ResourceBundle.getBundle()</code> with <code>UResourceBundle.getBundleInstance()</code>... easy peasy.  Unfortunately, not so easy.</p><p>Previously I had used the JDT ‘Externalize Strings’ wizard to externalize strings in my plug-in.  The JDT nicely created a utility class <code>Messages.java</code> alongside the resource bundle <code>messages.properties</code>.  This worked really well and has been in use for some time.  Unfortunately after converting to ICU4J UResourceBundle throws a NoClassDefFoundError because of the presence of the Messages class.  It seems that UResourceBundle cannot handle a resource bundle alongside a class by a similar name.  While I’ve logged <a href="https://bugs.eclipse.org/272166">bug 272166</a> to track this issue and have it fixed, it doesn’t help me.  Even if the bug gets fixed in time for Galileo, Mylyn WikiText must work on Eclipse 3.3 and 3.4 as well.</p><p>It gets worse.  Mylyn WikiText is already translated to German and Japanese.  Resource bundle message keys must remain relatively stable in order to avoid losing those translations.  JDT creates message keys containing dots ‘.’, and the Eclipse externalized string pattern cannot have dots in message keys... so I cannot convert over to the Eclipse externalized string pattern without losing these translations.</p><h4 id="MessageFormat">MessageFormat  </h4><p>MessageFormat evolved for Java 5: it’s <code>format()</code> method became a var-args method, meaning that you can pass a variable number of arguments to it.  WikiText makes extensive use of this method, so you’ll see code such as this:</p><pre><code><br />MessageFormat.format(messageTemplate,arg1,arg2)<br /></code></pre><p>ICU4J does not have a var-args method equivalent — it seems that ICU4J has not evolved for Java 5.  To adopt ICU4J’s MessageFormat, all calls had to be converted as follows:</p><pre><code><br />MessageFormat.format(messageTemplate, new Object[] { arg1, arg2 })<br /></code></pre><p>While the conversion can be achieved using regular expressions, the resulting code is less readable and more prone to bugs.  Localization is hard enough as it is without having to jump through age-old languageisms.</p><h4 id="Summary">Summary</h4><p>While converting all plug-ins to ICU4J may make sense for some, making it a requirement for Galileo participation has caused me and presumably others a lot of work.  From what I can see ICU4J brings little or no value to the users of my project.  This is one case where good intentions with policy have a substantial negative impact.  In my case, the time I’m spending converting to ICU4J could have been used to innovate or improve the quality of WikiText.  Instead I’m jumping through hoops with no apparent benefit for me, my project or my users.   </p>
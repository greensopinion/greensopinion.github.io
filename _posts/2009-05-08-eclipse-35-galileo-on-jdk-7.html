---
layout: post
title: Eclipse 3.5 (Galileo) on Java 7
date: '2009-05-08T15:49:00.000-07:00'
author: David Green
tags:
- JDK7
- SoyLatte
- Eclipse
- Java 7
modified_time: '2010-01-19T08:54:17.116-08:00'
blogger_id: tag:blogger.com,1999:blog-1482979278030787271.post-242174787200674003
original_url: http://greensopinion.blogspot.com/2009/05/eclipse-35-galileo-on-jdk-7.html
comments: true
---

<p>Some time ago I blogged about running <a href="http://greensopinion.com/2008/08/06/eclipse-ganymede-on-soylatte.html">Eclipse (Ganymede) on SoyLatte</a>.  Since then there has been little improvement in the state of Java on the Mac.  Apple has released a Java 6 for Mac, but it's a 64-bit only VM which <a href="https://bugs.eclipse.org/214092">crashes regularly</a> when running Eclipse.  Having heard about recent improvements in performance for 64-bit VMs using <a href="http://permalink.gmane.org/gmane.comp.java.openjdk.hotspot.compiler.devel/875">pointer compression</a> (<a href="http://users.elis.ugent.be/%7Eleeckhou/papers/ecoop07.pdf">PDF paper</a>), I decided to have another look at launching Eclipse with an OpenJDK-based VM such as JDK7.  After a few false starts I managed to get it working.  Here's what I did:</p><p>First, to get JDK7 on my machine.  I followed <a href="http://infernus.org/2009/02/building-java-7-on-mac-os-x/">these instructions</a> to build JDK 7 from source.  The instructions didn't work perfectly for me -- but they were pretty good.  Basically followed everything verbatim with the exception that I had to install MacPorts and use it to get wget.</p><p>With a 32-bit JDK7 on my machine, now to use it to start Eclipse.  I downloaded the latest I-build of 32-bit Eclipse 3.5 <a href="http://download.eclipse.org/eclipse/downloads/">from here</a>  (Look for '3.5 Stream Integration Builds').</p><p>Using a combination of jconsole and guesswork I came up with this shell script to start Eclipse:</p><pre><code><br />JDKPATH=/Users/dgreen/Documents/packages/jdk7-32bit-2009-05-08<br />DEBUG_OPTS=<br /># DEBUG_OPTS=-Xdebug -Xrunjdwp:transport=dt_socket,address=1044,server=y,suspend=y<br />MEM_OPTS=-Xms1024m\ -Xmx1536m\ -XX:MaxPermSize=256m<br />ECLIPSE_LOC=/Users/dgreen/Downloads/eclipse<br />WORKSPACE=/Users/dgreen/Documents/workspace<br /><br />$JDKPATH/bin/java $DEBUG_OPTS \<br />-cp $ECLIPSE_LOC/plugins/org.eclipse.equinox.launcher_1.0.200.v20090429-1630.jar \<br />-XstartOnFirstThread $MEM_OPTS \<br />-Dorg.eclipse.swt.internal.carbon.smallFonts \<br />-Djava.library.path=$ECLIPSE_LOC/Eclipse.app/Contents/MacOS/lib \<br />-Dswt.library.path=$ECLIPSE_LOC/Eclipse.app/Contents/MacOS/lib \<br />org.eclipse.equinox.launcher.Main \<br />-os macosx -ws cocoa -arch x86 \<br />-showsplash -launcher $ECLIPSE_LOC/Eclipse.app/Contents/MacOS/eclipse \<br />-name Eclipse \<br />--launcher.library $ECLIPSE_LOC/plugins/org.eclipse.equinox.launcher.cocoa.macosx_1.0.0.v20090429-1630  \<br />-startup $ECLIPSE_LOC/plugins/org.eclipse.equinox.launcher_1.0.200.v20090429-1630.jar \<br />-data $WORKSPACE \<br />-keyring /Users/dgreen/.eclipse_keyring -consoleLog -showlocation \<br />-vm $JDKPATH<br /></code></pre><p>Note that all of the above should appear on one line: your browser may split it into multiple lines.</p><p>After starting Eclipse as above I saw the following stack trace on startup:</p><pre><br />java.lang.UnsatisfiedLinkError: no swt-pi-cocoa-3547 or swt-pi-cocoa in swt.library.path, java.library.path or the jar file<br /> at org.eclipse.swt.internal.Library.loadLibrary(Library.java:248)<br /> at org.eclipse.swt.internal.Library.loadLibrary(Library.java:159)<br />       ... snip ...<br /></pre><p>To solve the problem I extracted all of the <tt>*.jnilib</tt> files from <tt>org.eclipse.equinox.launcher_*.jar</tt> and put them in a <tt>lib</tt> folder.  I then renamed all of those <tt>*.jnilib</tt> files in the <tt>lib</tt> folder so that they had <tt>*.dylib</tt> file extensions.  I ended up with a file structure as follows:</p><pre><br />david-greens-macbook-pro:MacOS dgreen$ pwd<br />/Users/dgreen/Downloads/eclipse/Eclipse.app/Contents/MacOS    <--- where I put the files<br />david-greens-macbook-pro:MacOS dgreen$ ls -l *.sh lib<br />-rwxr-xr-x@ 1 dgreen  staff  1100  8 May 15:47 eclipse.sh    <--- the startup script<br /><br />lib:        <---- the lib folder for shared libraries<br />total 2296<br />-rw-r--r--  1 dgreen  staff   37104  8 May 14:20 libswt-awt-cocoa-3547.dylib<br />-rw-r--r--  1 dgreen  staff  287116  8 May 14:20 libswt-cocoa-3547.dylib<br />-rw-r--r--  1 dgreen  staff  539240  8 May 14:20 libswt-pi-cocoa-3547.dylib<br />-rw-r--r--  1 dgreen  staff  300428  8 May 14:20 libswt-xulrunner-cocoa-3547.dylib<br /></pre><p>Trying the shell script again, Eclipse started up and ran beautifully!  Once again I'm running Eclipse with a newer-than-Apple-will-give-me VM, this time JDK 7!!  My next step is to compile a 64-bit JDK7 and see if it works too...  I have high hopes.</p><ul><li><em style="color:red;">Updated 2009-05-15</em> see <a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=276564">this issue (bug 276564)</a> for the underlying cause of failure</li><li><em style="color:red;">Updated 2010-01-19</em> see <a href="http://greensopinion.com/2010/01/19/eclipse-36-on-openjdk-on-mac-os-x.html">Eclipse 3.6 on OpenJDK on Mac OS X</a> for an update</li></ul>
